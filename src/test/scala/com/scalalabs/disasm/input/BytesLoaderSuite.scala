package com.scalalabs.disasm.input

import org.scalatest.FunSuite
import org.scalatest.matchers.ShouldMatchers
import org.scalatest.junit.JUnitRunner
import org.junit.runner.RunWith

@RunWith(classOf[JUnitRunner])
class BytesLoaderSuite extends FunSuite with ShouldMatchers {

  
  class TestObj
  
  test("basic") {
    val bytes:Array[Byte] = Array[Byte](00, 01, 0xff.toByte)

    val t = new TestObj with BytesLoader
    t.loader.load(bytes)
//    println( "S " + t.loader.stream )
    
    assert( 0x00 === t.loader.nextByte)
    assert( 0x01 === t.loader.nextByte)
    assert( 0xff === t.loader.nextByte)
    
  }

  
  ignore("bytes") {

    val t = new TestObj with DebugLoader
    t.loader.load(clazzStr)
    val s = t.loader.buffer
    println("Length " + s.length)
    (1 to 10).foreach( i => println("" + s(i).toInt.toHexString))
//    t.loader.load(clazzStr)
//    println( "S " + t.loader.stream )
    
    assert( 0x00 === t.loader.nextByte)
    assert( 0x01 === t.loader.nextByte)
    assert( 0xff === t.loader.nextByte)
    
  }

  val clazzStr = "CAFEBABE00000031005601000A536F7572636546696C6501000B48656C6C6F2E7363616C610100074D4F44554C45240100234C636F6D2F7363616C616C6162732F64697361736D2F696E7075742F48656C6C6F243B0100083C636C696E69743E010003282956010004436F6465010021636F6D2F7363616C616C6162732F64697361736D2F696E7075742F48656C6C6F240700080100063C696E69743E0C000A00060A0009000B01000568656C6C6F0100124C6A6176612F6C616E672F537472696E673B010003696E630100114C7363616C612F46756E6374696F6E323B0100494C7363616C612F46756E6374696F6E323C4C6A6176612F6C616E672F4F626A6563743B4C6A6176612F6C616E672F4F626A6563743B4C6A6176612F6C616E672F4F626A6563743B3E3B0100095369676E617475726501001428294C6A6176612F6C616E672F537472696E673B01000F4C696E654E756D6265725461626C650C000D000E09000900150100046D61696E010016285B4C6A6176612F6C616E672F537472696E673B295601000D7363616C612F5072656465662407001901000F4C7363616C612F507265646566243B0C0003001B09001A001C0C000D00130A0009001E0100077072696E746C6E010015284C6A6176612F6C616E672F4F626A6563743B29560C002000210A001A00220100086C6F6F70546573740100046C6F6F7008002501001328294C7363616C612F46756E6374696F6E323B0C000F0010090009002801004B28294C7363616C612F46756E6374696F6E323C4C6A6176612F6C616E672F4F626A6563743B4C6A6176612F6C616E672F4F626A6563743B4C6A6176612F6C616E672F4F626A6563743B3E3B0100037433610C000F00270A0009002C0100027433010014284C7363616C612F46756E6374696F6E323B29560C002E002F0A0009003001000F7363616C612F46756E6374696F6E3207003201000E6170706C79246D6349494924737001000528494929490C003400350B0033003601004C284C7363616C612F46756E6374696F6E323C4C6A6176612F6C616E672F4F626A6563743B4C6A6176612F6C616E672F4F626A6563743B4C6A6176612F6C616E672F4F626A6563743B3E3B2956010007657870546573740100106A6176612F6C616E672F53797374656D07003A01001163757272656E7454696D654D696C6C697301000328294A0C003C003D0A003B003E05000000000000000801000448656C700800420100136A6176612F6C616E672F457863657074696F6E0700440100106A6176612F6C616E672F4F626A6563740700460A0047000B0C00030004090009004901000B48656C6C6F20576F726C6408004B01002B636F6D2F7363616C616C6162732F64697361736D2F696E7075742F48656C6C6F2424616E6F6E66756E243107004D0A004E000B0100055363616C6101000C496E6E6572436C6173736573010020636F6D2F7363616C616C6162732F64697361736D2F696E7075742F48656C6C6F0700520100117363616C612F5363616C614F626A65637407005400310009004700010055000300190003000400000012000D000E00000012000F001000010012000000020011000900090005000600010007000000130001000000000007BB0009B7000CB1000000000001000D0013000100070000001D00010001000000052AB40016B0000000010014000000060001000000050001001700180001000700000023000200020000000BB2001D2AB6001FB60023B1000000010014000000060001000000080001002400060001000700000023000200010000000BB2001D1226B60023A7FFF80000000100140000000600010000000D0001000F0027000200070000001D00010001000000052AB40029B000000001001400000006000100000012001200000002002A0001002B0006000100070000002100020001000000092A2AB6002DB60031B1000000010014000000060001000000160001002E002F0002000700000022000300030000000A2B0405B9003703003DB10000000100140000000600010000001A0012000000020038000100390006000100070000003D0004000400000015B8003F1400406D41A7000C4CB2001D1243B60023B100010000000B000B0045000100140000000E00030000001F000B00210014001E0002000A0006000100070000003A000300010000001A2AB700482AB3004A2A124CB500162ABB004E59B7004FB50029B10000000100140000000E00030000000300080005000E00120003000100000002000200500000000000510000000A0001004E005300000019" 
  
}